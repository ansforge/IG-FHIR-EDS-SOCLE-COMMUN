{
  "resourceType" : "StructureMap",
  "id" : "Patient",
  "text" : {
    "status" : "generated",
    "div" : "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p class=\"res-header-id\"><b>Generated Narrative: StructureMap Patient</b></p><a name=\"Patient\"> </a><a name=\"hcPatient\"> </a><a name=\"Patient-fr-FR\"> </a><pre class=\"fml\">\r\n<b>map</b><span style=\"color: navy\"> &quot;</span>https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Patient<span style=\"color: navy\">&quot; = &quot;</span>Patient<span style=\"color: navy\">&quot;\r\n\r\n</span><span style=\"color: navy\">// </span><span style=\"color: green\">Mapping Patient resource to Person, Location and Death OMOP Domain</span>\r\n\r\n<b>uses</b><span style=\"color: navy\"> &quot;</span><a href=\"StructureDefinition-EDSPatient.html\" title=\"EDS Patient\">https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/EDSPatient</a><span style=\"color: navy\">&quot; </span><b>alias </b>Patient <b>as </b><b>source</b>\r\n<b>uses</b><span style=\"color: navy\"> &quot;</span><a href=\"http://hl7.org/fhir/R4/bundle.html\" title=\"Bundle\">http://hl7.org/fhir/StructureDefinition/Bundle</a><span style=\"color: navy\">&quot; </span><b>as </b><b>target</b>\r\n\r\n<b>imports</b><span style=\"color: navy\"> &quot;</span><a href=\"StructureMap-Person.html\" title=\"Mapping Patient resource to Person OMOP Domain\">https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Person</a><span style=\"color: navy\">&quot;\r\n</span><b>imports</b><span style=\"color: navy\"> &quot;</span><a href=\"StructureMap-Location.html\" title=\"Mapping Patient resource to Location OMOP Domain\">https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Location</a><span style=\"color: navy\">&quot;\r\n</span><b>imports</b><span style=\"color: navy\"> &quot;</span><a href=\"StructureMap-Death.html\" title=\"Mapping Patient resource to Death OMOP Domain\">https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Death</a><span style=\"color: navy\">&quot;\r\n</span>\r\n<b>group </b>Patient<span style=\"color: navy\">(</span><b>source</b> <span style=\"color: maroon\">src</span><span style=\"color: navy\"> : </span>Patient, <b>target</b> <span style=\"color: maroon\">tgtBundle</span><span style=\"color: navy\"> : </span>Bundle<span style=\"color: navy\">)</span><span style=\"color: navy\"> {\r\n</span>  src.id<b> as </b><span style=\"color: maroon\">srcId</span><span style=\"color: navy\"><b> -&gt; </b></span>tgtBundle.id = <b>uuid</b><span style=\"color: navy\">(</span><span style=\"color: navy\">)</span> <i>&quot;setId&quot;</i><span style=\"color: navy\">;</span>\r\n  src<span style=\"color: navy\"><b> -&gt; </b></span>tgtBundle.type = <span style=\"color: blue\">'transaction'</span> <i>&quot;setType&quot;</i><span style=\"color: navy\">;</span>\r\n  src<span style=\"color: navy\"><b> -&gt; </b></span>tgtBundle.entry<b> as </b><span style=\"color: maroon\">newEntry</span><b> then</b><span style=\"color: navy\"> {\r\n</span>    src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.resource = <b>create</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'Provenance'</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">newProvenance</span><b> then</b><span style=\"color: navy\"> {\r\n</span>      src<span style=\"color: navy\"><b> -&gt; </b></span> newProvenance.agent<b> as </b><span style=\"color: maroon\">agent</span><span style=\"color: navy\">, </span> agent.who = <b>reference</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'?mapper?'</span><span style=\"color: navy\">)</span> <i>&quot;setProvenanceAgent&quot;</i><span style=\"color: navy\">;</span>\r\n      src<span style=\"color: navy\"><b> -&gt; </b></span> newProvenance.entity<b> as </b><span style=\"color: maroon\">entitySource</span><span style=\"color: navy\">, </span> <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'Patient/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">srcId</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">whatRef</span><span style=\"color: navy\">, </span> entitySource.what = <b>reference</b><span style=\"color: navy\">(</span><span style=\"color: maroon\">whatRef</span><span style=\"color: navy\">)</span><span style=\"color: navy\">, </span> entitySource.role = <span style=\"color: blue\">'source'</span> <i>&quot;setProvenanceEntitySource&quot;</i><span style=\"color: navy\">;</span>\r\n      src<span style=\"color: navy\"><b> -&gt; </b></span>newProvenance.activity = <b>cc</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'http://terminology.hl7.org/CodeSystem/v3-DataOperation'</span><span style=\"color: navy\">, </span><span style=\"color: blue\">'CREATE'</span><span style=\"color: navy\">)</span> <i>&quot;setProvenanceActivity&quot;</i><span style=\"color: navy\">;</span>\r\n      src<span style=\"color: navy\"><b> -&gt; </b></span>tgtBundle.entry<b> as </b><span style=\"color: maroon\">newEntry</span><b> then</b><span style=\"color: navy\"> {\r\n</span>        src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.resource = <b>create</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/Person'</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">newPerson</span><b> then</b><span style=\"color: navy\"> {\r\n</span>          src<span style=\"color: navy\"><b> -&gt; </b></span>newPerson.person_id = <b>uuid</b><span style=\"color: navy\">(</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">newPersonId</span> <i>&quot;setId&quot;</i><span style=\"color: navy\">;</span>\r\n          src<span style=\"color: navy\"><b> -&gt; </b></span> <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'Person/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newPersonId</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">targetRef</span><span style=\"color: navy\">, </span> newProvenance.target = <b>reference</b><span style=\"color: navy\">(</span><span style=\"color: maroon\">targetRef</span><span style=\"color: navy\">)</span> <i>&quot;setProvenanceTarget&quot;</i><span style=\"color: navy\">;</span>\r\n          src<b> then </b>Person<span style=\"color: navy\">(</span><span style=\"color: maroon\">src</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newPerson</span><span style=\"color: navy\">)</span> <i>&quot;transformPerson&quot;</i><span style=\"color: navy\">;</span>\r\n          src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.fullUrl = <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'https://interop.esante.gouv.fr/ig/fhir/eds/Person/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newPersonId</span><span style=\"color: navy\">)</span> <i>&quot;setFullUrl&quot;</i><span style=\"color: navy\">;</span>\r\n          src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.request<b> as </b><span style=\"color: maroon\">newRequest</span><b> then</b><span style=\"color: navy\"> {\r\n</span>            src<span style=\"color: navy\"><b> -&gt; </b></span>newRequest.method = <span style=\"color: blue\">'POST'</span> <i>&quot;setMethod&quot;</i><span style=\"color: navy\">;</span>\r\n            src<span style=\"color: navy\"><b> -&gt; </b></span>newRequest.url = <span style=\"color: blue\">'Person'</span> <i>&quot;setUrl&quot;</i><span style=\"color: navy\">;</span>\r\n          <span style=\"color: navy\">}</span> <i>&quot;setEntryRequest&quot;</i><span style=\"color: navy\">;</span>\r\n          src<b> where </b>address.empty().not()<span style=\"color: navy\"><b> -&gt; </b></span>tgtBundle.entry<b> as </b><span style=\"color: maroon\">newEntry</span><b> then</b><span style=\"color: navy\"> {\r\n</span>            src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.resource = <b>create</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/Location'</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">newLocation</span><b> then</b><span style=\"color: navy\"> {\r\n</span>              src<span style=\"color: navy\"><b> -&gt; </b></span>newLocation.location_id = <b>uuid</b><span style=\"color: navy\">(</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">newLocationId</span> <i>&quot;setId&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span> <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'Location/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newLocationId</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">targetRef</span><span style=\"color: navy\">, </span> newProvenance.target = <b>reference</b><span style=\"color: navy\">(</span><span style=\"color: maroon\">targetRef</span><span style=\"color: navy\">)</span> <i>&quot;setProvenanceTarget&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span>newPerson.location_id = <span style=\"color: maroon\">newLocationId</span> <i>&quot;setPersonLocationId&quot;</i><span style=\"color: navy\">;</span>\r\n              src<b> then </b>Location<span style=\"color: navy\">(</span><span style=\"color: maroon\">src</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newLocation</span><span style=\"color: navy\">)</span> <i>&quot;transformLocation&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.fullUrl = <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'https://interop.esante.gouv.fr/ig/fhir/eds/Location/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newLocationId</span><span style=\"color: navy\">)</span> <i>&quot;setFullUrl&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.request<b> as </b><span style=\"color: maroon\">newRequest</span><b> then</b><span style=\"color: navy\"> {\r\n</span>                src<span style=\"color: navy\"><b> -&gt; </b></span>newRequest.method = <span style=\"color: blue\">'POST'</span> <i>&quot;setMethod&quot;</i><span style=\"color: navy\">;</span>\r\n                src<span style=\"color: navy\"><b> -&gt; </b></span>newRequest.url = <span style=\"color: blue\">'Location'</span> <i>&quot;setUrl&quot;</i><span style=\"color: navy\">;</span>\r\n              <span style=\"color: navy\">}</span> <i>&quot;setEntryRequest&quot;</i><span style=\"color: navy\">;</span>\r\n            <span style=\"color: navy\">}</span> <i>&quot;createLocation&quot;</i><span style=\"color: navy\">;</span>\r\n          <span style=\"color: navy\">}</span> <i>&quot;newEntryLocation&quot;</i><span style=\"color: navy\">;</span>\r\n          src<b> where </b>(deceased.ofType(Boolean) = true) or deceased.ofType(Datetime).empty().not()<span style=\"color: navy\"><b> -&gt; </b></span>tgtBundle.entry<b> as </b><span style=\"color: maroon\">newEntry</span><b> then</b><span style=\"color: navy\"> {\r\n</span>            src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.resource = <b>create</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/Death'</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">newDeath</span><b> then</b><span style=\"color: navy\"> {\r\n</span>              src<span style=\"color: navy\"><b> -&gt; </b></span>newDeath.person_id = <span style=\"color: maroon\">newPersonId</span> <i>&quot;setId&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span> <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'Death/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newPersonId</span><span style=\"color: navy\">)</span><b> as </b><span style=\"color: maroon\">targetRef</span><span style=\"color: navy\">, </span> newProvenance.target = <b>reference</b><span style=\"color: navy\">(</span><span style=\"color: maroon\">targetRef</span><span style=\"color: navy\">)</span> <i>&quot;setProvenanceTarget&quot;</i><span style=\"color: navy\">;</span>\r\n              src<b> then </b>Death<span style=\"color: navy\">(</span><span style=\"color: maroon\">src</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newDeath</span><span style=\"color: navy\">)</span> <i>&quot;transformDeath&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.fullUrl = <b>append</b><span style=\"color: navy\">(</span><span style=\"color: blue\">'https://interop.esante.gouv.fr/ig/fhir/eds/Death/'</span><span style=\"color: navy\">, </span><span style=\"color: maroon\">newPersonId</span><span style=\"color: navy\">)</span> <i>&quot;setFullUrl&quot;</i><span style=\"color: navy\">;</span>\r\n              src<span style=\"color: navy\"><b> -&gt; </b></span>newEntry.request<b> as </b><span style=\"color: maroon\">newRequest</span><b> then</b><span style=\"color: navy\"> {\r\n</span>                src<span style=\"color: navy\"><b> -&gt; </b></span>newRequest.method = <span style=\"color: blue\">'POST'</span> <i>&quot;setMethod&quot;</i><span style=\"color: navy\">;</span>\r\n                src<span style=\"color: navy\"><b> -&gt; </b></span>newRequest.url = <span style=\"color: blue\">'Death'</span> <i>&quot;setUrl&quot;</i><span style=\"color: navy\">;</span>\r\n              <span style=\"color: navy\">}</span> <i>&quot;setEntryRequest&quot;</i><span style=\"color: navy\">;</span>\r\n            <span style=\"color: navy\">}</span> <i>&quot;createDeath&quot;</i><span style=\"color: navy\">;</span>\r\n          <span style=\"color: navy\">}</span> <i>&quot;newEntryDeath&quot;</i><span style=\"color: navy\">;</span>\r\n        <span style=\"color: navy\">}</span> <i>&quot;createPerson&quot;</i><span style=\"color: navy\">;</span>\r\n      <span style=\"color: navy\">}</span> <i>&quot;newEntryPerson&quot;</i><span style=\"color: navy\">;</span>\r\n    <span style=\"color: navy\">}</span> <i>&quot;createProvenance&quot;</i><span style=\"color: navy\">;</span>\r\n  <span style=\"color: navy\">}</span> <i>&quot;newEntryProvenance&quot;</i><span style=\"color: navy\">;</span>\r\n<span style=\"color: navy\">}\r\n\r\n</span></pre></div>"
  },
  "url" : "https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Patient",
  "version" : "0.1.0",
  "name" : "Patient",
  "title" : "Mapping Patient resource to Person, Location and Death OMOP Domain",
  "status" : "draft",
  "date" : "2024-07-19T13:38:23+00:00",
  "publisher" : "ANS",
  "contact" : [{
    "name" : "ANS",
    "telecom" : [{
      "system" : "url",
      "value" : "https://esante.gouv.fr"
    }]
  }],
  "description" : "Mapping Patient resource to Person, Location and Death OMOP Domain",
  "jurisdiction" : [{
    "coding" : [{
      "system" : "urn:iso:std:iso:3166",
      "code" : "FR",
      "display" : "France"
    }]
  }],
  "structure" : [{
    "url" : "https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/EDSPatient",
    "mode" : "source",
    "alias" : "Patient"
  },
  {
    "url" : "http://hl7.org/fhir/StructureDefinition/Bundle",
    "mode" : "target"
  }],
  "import" : ["https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Person",
  "https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Location",
  "https://interop.esante.gouv.fr/ig/fhir/eds/StructureMap/Death"],
  "group" : [{
    "name" : "Patient",
    "typeMode" : "none",
    "input" : [{
      "name" : "src",
      "type" : "Patient",
      "mode" : "source"
    },
    {
      "name" : "tgtBundle",
      "type" : "Bundle",
      "mode" : "target"
    }],
    "rule" : [{
      "name" : "setId",
      "source" : [{
        "context" : "src",
        "element" : "id",
        "variable" : "srcId"
      }],
      "target" : [{
        "context" : "tgtBundle",
        "contextType" : "variable",
        "element" : "id",
        "transform" : "uuid"
      }]
    },
    {
      "name" : "setType",
      "source" : [{
        "context" : "src"
      }],
      "target" : [{
        "context" : "tgtBundle",
        "contextType" : "variable",
        "element" : "type",
        "transform" : "copy",
        "parameter" : [{
          "valueString" : "transaction"
        }]
      }]
    },
    {
      "name" : "newEntryProvenance",
      "source" : [{
        "context" : "src"
      }],
      "target" : [{
        "context" : "tgtBundle",
        "contextType" : "variable",
        "element" : "entry",
        "variable" : "newEntry"
      }],
      "rule" : [{
        "name" : "createProvenance",
        "source" : [{
          "context" : "src"
        }],
        "target" : [{
          "context" : "newEntry",
          "contextType" : "variable",
          "element" : "resource",
          "variable" : "newProvenance",
          "transform" : "create",
          "parameter" : [{
            "valueString" : "Provenance"
          }]
        }],
        "rule" : [{
          "name" : "setProvenanceAgent",
          "source" : [{
            "context" : "src"
          }],
          "target" : [{
            "context" : "newProvenance",
            "contextType" : "variable",
            "element" : "agent",
            "variable" : "agent"
          },
          {
            "context" : "agent",
            "contextType" : "variable",
            "element" : "who",
            "transform" : "reference",
            "parameter" : [{
              "valueString" : "?mapper?"
            }]
          }]
        },
        {
          "name" : "setProvenanceEntitySource",
          "source" : [{
            "context" : "src"
          }],
          "target" : [{
            "context" : "newProvenance",
            "contextType" : "variable",
            "element" : "entity",
            "variable" : "entitySource"
          },
          {
            "contextType" : "variable",
            "variable" : "whatRef",
            "transform" : "append",
            "parameter" : [{
              "valueString" : "Patient/"
            },
            {
              "valueId" : "srcId"
            }]
          },
          {
            "context" : "entitySource",
            "contextType" : "variable",
            "element" : "what",
            "transform" : "reference",
            "parameter" : [{
              "valueId" : "whatRef"
            }]
          },
          {
            "context" : "entitySource",
            "contextType" : "variable",
            "element" : "role",
            "transform" : "copy",
            "parameter" : [{
              "valueString" : "source"
            }]
          }]
        },
        {
          "name" : "setProvenanceActivity",
          "source" : [{
            "context" : "src"
          }],
          "target" : [{
            "context" : "newProvenance",
            "contextType" : "variable",
            "element" : "activity",
            "transform" : "cc",
            "parameter" : [{
              "valueString" : "http://terminology.hl7.org/CodeSystem/v3-DataOperation"
            },
            {
              "valueString" : "CREATE"
            }]
          }]
        },
        {
          "name" : "newEntryPerson",
          "source" : [{
            "context" : "src"
          }],
          "target" : [{
            "context" : "tgtBundle",
            "contextType" : "variable",
            "element" : "entry",
            "variable" : "newEntry"
          }],
          "rule" : [{
            "name" : "createPerson",
            "source" : [{
              "context" : "src"
            }],
            "target" : [{
              "context" : "newEntry",
              "contextType" : "variable",
              "element" : "resource",
              "variable" : "newPerson",
              "transform" : "create",
              "parameter" : [{
                "valueString" : "https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/Person"
              }]
            }],
            "rule" : [{
              "name" : "setId",
              "source" : [{
                "context" : "src"
              }],
              "target" : [{
                "context" : "newPerson",
                "contextType" : "variable",
                "element" : "person_id",
                "variable" : "newPersonId",
                "transform" : "uuid"
              }]
            },
            {
              "name" : "setProvenanceTarget",
              "source" : [{
                "context" : "src"
              }],
              "target" : [{
                "contextType" : "variable",
                "variable" : "targetRef",
                "transform" : "append",
                "parameter" : [{
                  "valueString" : "Person/"
                },
                {
                  "valueId" : "newPersonId"
                }]
              },
              {
                "context" : "newProvenance",
                "contextType" : "variable",
                "element" : "target",
                "transform" : "reference",
                "parameter" : [{
                  "valueId" : "targetRef"
                }]
              }]
            },
            {
              "name" : "transformPerson",
              "source" : [{
                "context" : "src"
              }],
              "dependent" : [{
                "name" : "Person",
                "variable" : ["src",
                "newPerson"]
              }]
            },
            {
              "name" : "setFullUrl",
              "source" : [{
                "context" : "src"
              }],
              "target" : [{
                "context" : "newEntry",
                "contextType" : "variable",
                "element" : "fullUrl",
                "transform" : "append",
                "parameter" : [{
                  "valueString" : "https://interop.esante.gouv.fr/ig/fhir/eds/Person/"
                },
                {
                  "valueId" : "newPersonId"
                }]
              }]
            },
            {
              "name" : "setEntryRequest",
              "source" : [{
                "context" : "src"
              }],
              "target" : [{
                "context" : "newEntry",
                "contextType" : "variable",
                "element" : "request",
                "variable" : "newRequest"
              }],
              "rule" : [{
                "name" : "setMethod",
                "source" : [{
                  "context" : "src"
                }],
                "target" : [{
                  "context" : "newRequest",
                  "contextType" : "variable",
                  "element" : "method",
                  "transform" : "copy",
                  "parameter" : [{
                    "valueString" : "POST"
                  }]
                }]
              },
              {
                "name" : "setUrl",
                "source" : [{
                  "context" : "src"
                }],
                "target" : [{
                  "context" : "newRequest",
                  "contextType" : "variable",
                  "element" : "url",
                  "transform" : "copy",
                  "parameter" : [{
                    "valueString" : "Person"
                  }]
                }]
              }]
            },
            {
              "name" : "newEntryLocation",
              "source" : [{
                "context" : "src",
                "condition" : "address.empty().not()"
              }],
              "target" : [{
                "context" : "tgtBundle",
                "contextType" : "variable",
                "element" : "entry",
                "variable" : "newEntry"
              }],
              "rule" : [{
                "name" : "createLocation",
                "source" : [{
                  "context" : "src"
                }],
                "target" : [{
                  "context" : "newEntry",
                  "contextType" : "variable",
                  "element" : "resource",
                  "variable" : "newLocation",
                  "transform" : "create",
                  "parameter" : [{
                    "valueString" : "https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/Location"
                  }]
                }],
                "rule" : [{
                  "name" : "setId",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newLocation",
                    "contextType" : "variable",
                    "element" : "location_id",
                    "variable" : "newLocationId",
                    "transform" : "uuid"
                  }]
                },
                {
                  "name" : "setProvenanceTarget",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "contextType" : "variable",
                    "variable" : "targetRef",
                    "transform" : "append",
                    "parameter" : [{
                      "valueString" : "Location/"
                    },
                    {
                      "valueId" : "newLocationId"
                    }]
                  },
                  {
                    "context" : "newProvenance",
                    "contextType" : "variable",
                    "element" : "target",
                    "transform" : "reference",
                    "parameter" : [{
                      "valueId" : "targetRef"
                    }]
                  }]
                },
                {
                  "name" : "setPersonLocationId",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newPerson",
                    "contextType" : "variable",
                    "element" : "location_id",
                    "transform" : "copy",
                    "parameter" : [{
                      "valueId" : "newLocationId"
                    }]
                  }]
                },
                {
                  "name" : "transformLocation",
                  "source" : [{
                    "context" : "src"
                  }],
                  "dependent" : [{
                    "name" : "Location",
                    "variable" : ["src",
                    "newLocation"]
                  }]
                },
                {
                  "name" : "setFullUrl",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newEntry",
                    "contextType" : "variable",
                    "element" : "fullUrl",
                    "transform" : "append",
                    "parameter" : [{
                      "valueString" : "https://interop.esante.gouv.fr/ig/fhir/eds/Location/"
                    },
                    {
                      "valueId" : "newLocationId"
                    }]
                  }]
                },
                {
                  "name" : "setEntryRequest",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newEntry",
                    "contextType" : "variable",
                    "element" : "request",
                    "variable" : "newRequest"
                  }],
                  "rule" : [{
                    "name" : "setMethod",
                    "source" : [{
                      "context" : "src"
                    }],
                    "target" : [{
                      "context" : "newRequest",
                      "contextType" : "variable",
                      "element" : "method",
                      "transform" : "copy",
                      "parameter" : [{
                        "valueString" : "POST"
                      }]
                    }]
                  },
                  {
                    "name" : "setUrl",
                    "source" : [{
                      "context" : "src"
                    }],
                    "target" : [{
                      "context" : "newRequest",
                      "contextType" : "variable",
                      "element" : "url",
                      "transform" : "copy",
                      "parameter" : [{
                        "valueString" : "Location"
                      }]
                    }]
                  }]
                }]
              }]
            },
            {
              "name" : "newEntryDeath",
              "source" : [{
                "context" : "src",
                "condition" : "(deceased.ofType(Boolean) = true) or deceased.ofType(Datetime).empty().not()"
              }],
              "target" : [{
                "context" : "tgtBundle",
                "contextType" : "variable",
                "element" : "entry",
                "variable" : "newEntry"
              }],
              "rule" : [{
                "name" : "createDeath",
                "source" : [{
                  "context" : "src"
                }],
                "target" : [{
                  "context" : "newEntry",
                  "contextType" : "variable",
                  "element" : "resource",
                  "variable" : "newDeath",
                  "transform" : "create",
                  "parameter" : [{
                    "valueString" : "https://interop.esante.gouv.fr/ig/fhir/eds/StructureDefinition/Death"
                  }]
                }],
                "rule" : [{
                  "name" : "setId",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newDeath",
                    "contextType" : "variable",
                    "element" : "person_id",
                    "transform" : "copy",
                    "parameter" : [{
                      "valueId" : "newPersonId"
                    }]
                  }]
                },
                {
                  "name" : "setProvenanceTarget",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "contextType" : "variable",
                    "variable" : "targetRef",
                    "transform" : "append",
                    "parameter" : [{
                      "valueString" : "Death/"
                    },
                    {
                      "valueId" : "newPersonId"
                    }]
                  },
                  {
                    "context" : "newProvenance",
                    "contextType" : "variable",
                    "element" : "target",
                    "transform" : "reference",
                    "parameter" : [{
                      "valueId" : "targetRef"
                    }]
                  }]
                },
                {
                  "name" : "transformDeath",
                  "source" : [{
                    "context" : "src"
                  }],
                  "dependent" : [{
                    "name" : "Death",
                    "variable" : ["src",
                    "newDeath"]
                  }]
                },
                {
                  "name" : "setFullUrl",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newEntry",
                    "contextType" : "variable",
                    "element" : "fullUrl",
                    "transform" : "append",
                    "parameter" : [{
                      "valueString" : "https://interop.esante.gouv.fr/ig/fhir/eds/Death/"
                    },
                    {
                      "valueId" : "newPersonId"
                    }]
                  }]
                },
                {
                  "name" : "setEntryRequest",
                  "source" : [{
                    "context" : "src"
                  }],
                  "target" : [{
                    "context" : "newEntry",
                    "contextType" : "variable",
                    "element" : "request",
                    "variable" : "newRequest"
                  }],
                  "rule" : [{
                    "name" : "setMethod",
                    "source" : [{
                      "context" : "src"
                    }],
                    "target" : [{
                      "context" : "newRequest",
                      "contextType" : "variable",
                      "element" : "method",
                      "transform" : "copy",
                      "parameter" : [{
                        "valueString" : "POST"
                      }]
                    }]
                  },
                  {
                    "name" : "setUrl",
                    "source" : [{
                      "context" : "src"
                    }],
                    "target" : [{
                      "context" : "newRequest",
                      "contextType" : "variable",
                      "element" : "url",
                      "transform" : "copy",
                      "parameter" : [{
                        "valueString" : "Death"
                      }]
                    }]
                  }]
                }]
              }]
            }]
          }]
        }]
      }]
    }]
  }]
}